# @ui5/ts-interface-generator

This npm package supports UI5 control development in TypeScript by generating TypeScript interfaces which declare the methods generated by UI5 only at runtime.

## Status

<b>IMPORTANT: this tool is ALPHA-quality work in progress right now, with plenty of limitations! And there are changes ahead which may force users to adapt. Use at your own risk to give feedback. As long as it doesn't crash along the way, it should already be capable of creating nice control interfaces which will save you quite some manual work.<br>
Note the "TODO" section below as well.<br>
Also note that this tool does not transpile the TypeScript controls to JavaScript! It only ensures TypeScript development can happen smoothly without being blocked by TypeScript not knowing the methods and structures generated by UI5 at runtime.</b>

## Installation

Go into a directory containing a TypeScript project which includes UI5 controls written in TypeScript (written as ES6 classes!). Install this generator as dev dependency by doing:

```sh
npm install --save-dev @ui5/ts-interface-generator
```

## Usage

To start the generator, run:

```sh
npx @ui5/ts-interface-generator --watch
```

This reqires a `tsconfig.json` file to be present in the same directory in order to find the source files and the dependencies (e.g. those declaring the UI5 types). You can alternatively specify the tsconfig file to be used by adding the `--config ./path/to/my-better-tsconfig.json` parameter.

The interface generation is then run a) initially and b) on every TypeScript source file modification or addition.
In case only a single generation run is wanted, omit the `--watch` parameter.

After generation, next to the control implementation there will be an additional `MyClassName.generated.tsinterface.ts` file. (More precisely: for every class which derives from ManagedObject and defines API metadata.) This file contains an interface declaring the methods generated at runtime and an interface defining the constructor settings object. It is generated in a way that makes TypeScript recognize it as <i>addition</i> to the regular control implementation (using [interface merging](https://www.typescriptlang.org/docs/handbook/declaration-merging.html#merging-interfaces) and [module augmentation](https://www.typescriptlang.org/docs/handbook/declaration-merging.html#module-augmentation)).

Generated interfaces are (as of now) never deleted (even when the original class is deleted), but always completely overridden in case of a new interface generation run.

In case you want to delete all generated interface files, you can do so manually, e.g. by doing the following (first line only needed once):

```sh
npm install shx --save-dev
npx shx rm **/*.generated.tsinterface.ts
```

### Limitations

There are limits to what the tool can achieve, trying to find and parse the classes for which it needs to generated an interface.

See the [TODO](#TODO) section for examples of features not yet implemented.

Certain requirements need to be fulfilled to make the detection of classes work, for which interfaces need to be generated:

- the class declaration must be a top-level statement in the file
- the metadata must be declared as a PropertyDeclaration, which is a top-level static member of the class with the name "metadata"
- ...

For detecting whether the required constructor signatures are already present in the class implementation, the constructors must syntactically match the content of the suggested three code lines.

In general, if something does not work, try to make the code structure as close as possible to the sample control in this project because right now only the straight-forward standard case is supported.

## Why?

When developing UI5 controls, the control metadata declares properties, aggregations, events etc. The methods related to these (like `getText()` for a `text` property or `attachPress(...)` for a `press` event do not need to be implemented - they are generated by the UI5 framework at runtime.

However, as the TypeScript environment does not know about these methods, a call to any of them will be marked as error in the source code. And on top of this, there is also no code completion for these methods and no type information and in-place documentation for parameters and return values.

This is a problem for application code using controls developed in TypeScript as well as for the development of these controls in TypeScript. Both development scenarios involve calling those API methods which are not known to the TypeScript environment. Thus, there needs to be a way to make TypeScript aware of them.

(Remark: the controls shipped with the UI5 framework are implemented in JavaScript and a complete set of TypeScript type definitions is created during the framework build from the JSDoc comments. So both facets of the problem do not apply for them.)

## How it Works

This tool scans all TypeScript source files for <b>top-level definitions of classes</b> inheriting from `sap.ui.base.ManagedObject` (in most cases those might be sub-classes of `sap.ui.core.Control`, so they will be called "controls" for simplicity).

For any such control, the metadata is parsed, analyzed, and a new TypeScript file is constructed, which contains an interface declaration with the methods generated by UI5 at runtime.

Unfortunately these separate interface declarations cannot define new constructors (see e.g. [this related TS issue](https://github.com/microsoft/TypeScript/issues/2957)). Hence those must be manually added to each control (one-time effort, pasting 3 lines of code). The interface generator writes the required lines to the console.

Oh, and the tool itself is implemented in TypeScript because TypeScript makes development more efficient. ;-)

## TODO

- Allow binding strings in addition to objects of the correct type in the constructor settings objects
- copy the original API documentation to the generated methods
- make sure watch mode does it right (also run on deletion? Delete interfaces before-creating? Only create interfaces for updated files?)
- consider further information like deprecation etc.
- last output is "Watching for file changes." even when a _single_ run has finished
- it is probably needed to check whether the control class being handled is the default export or a named export. Right now it is assumed that it is the default export. Other cases are not tested and likely not working.
- ...

## Support

This tool is supplied as-is, with no support provided. [Issue reports](https://github.com/SAP/ui5-typescript/issues) are welcome, as we want to improve it, but there is no guarantee that issue reports will be handled.
